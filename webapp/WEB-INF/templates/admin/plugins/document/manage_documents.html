<#macro setBtnAction action_nb >
	<#switch action_nb>
		<#case 1>
		<#case 6>
		<#case 8>
		<#case 11>
			<#assign btnAction="btn-danger" />
			<#break>
		<#case 14>
		<#case 15>
			<#assign btnAction="btn-info" />
			<#break>	
		<#case 4>
		<#case 12>
		<#case 13>
			<#assign btnAction="btn-success" />
			<#break>
		<#case 10>
			<#assign btnAction="btn-inverse" />
			<#break>
		<#case 5>
			<#assign btnAction="btn-warning" />
			<#break>
		<#default>
		<#assign btnAction="btn-primary" />
	</#switch>
	${btnAction}
</#macro>

<div class="row">
	<div class="col-xs-12 col-sm-12 col-md-3">
		<div class="well well-sm">
			<h4>#i18n{document.manage_documents.buttonSearch}</h4>
			<form class="form" method="post" id="SearchDocumentById"
				name="SearchDocumentById"
				action="jsp/admin/plugins/document/DoSearchDocumentById.jsp">
				<div class="form-group">
					<input type="text" id="id_document" name="id_document"
						class="input-sm" maxlength="10">
					<button class="btn btn-primary btn-sm" type="submit"
						title="#i18n{document.manage_documents.buttonSearch}">
						<i class="glyphicon glyphicon-search"></i>
					</button>
				</div>
				<p class="help-block">#i18n{document.manage_documents.labelSearchById}</p>
			</form>
			<form class="form-inline" method="post" id="FullTextSearchDocument"
				name="FullTextSearchDocument"
				action="jsp/admin/plugins/document/DocumentSearch.jsp">
				<input type="hidden" id="id_document" name="id_document">
				<div class="form-group">
					<div class="col-xs-12 col-sm-12 col-md-12">
					<input type="text" class="form-control" id="query" name="query"
						class="input-sm" maxlength="50">
					</div>
				</div>
				<button class="btn btn-primary btn-sm" type="submit"
					title="#i18n{document.manage_documents.buttonSearch}">
					<i class="glyphicon glyphicon-search"></i>
				</button>
				<p class="help-block">#i18n{document.manage_documents.labelFullTextSearch}</p>
			</form>
		</div>
		<div class="well well-sm">
			<h4>
				#i18n{document.manage_documents.labelSpaces} <#if
				space_actions_list?size != 0 >
				<div class="btn-group pull-right">
					<#list space_actions_list as space_action> <a
						href="${space_action.url}?id_space=${space.id}"
						alt="${space_action.description}"
						title="${space_action.description}"
						class="btn btn-sm <#if space_action.permission="DELETE">btn-danger<#else>btn-primary</#if>">
						<i class="${space_action.iconUrl}"></i>
					</a> </#list>
				</div>
				</#if>
			</h4>
			${spaces_tree}
		</div>
		<#if mass_action?has_content && mass_action>
		<div class="well well-sm">
			<h4>#i18n{document.manage_documents.labelMoreActions}</h4>
			<form class="form" method="post" id="archiveForm" name="archiveForm"
				action="jsp/admin/plugins/document/MassArchivalDocument.jsp">
				<button class="btn btn-primary btn-xs" type="submit">
					<i class="glyphicon glyphicon-lock"></i>&nbsp;#i18n{document.manage_document.mass_archival_labelBtn}
				</button>
			</form>
		</div>
		</#if>
	</div>
	
	
	
	<div class="col-xs-12 col-sm-12 col-md-9">
		<#if space?has_content >
		<div class="lead">
			#i18n{document.manage_documents.listTitle} <#if
			space.documentCreationAllowed > <#if document_types_list?has_content
			>
			<form class="form-inline pull-right" method="post"
				name="CreateDocument"
				action="jsp/admin/plugins/document/CreateDocument.jsp">
				<!--#i18n{document.manage_documents.labelCreate} :-->
				<@comboWithParams name="document_type_code" default_value=""
				additionalParameters="class=\"input-sm\"" items=document_types_list
				/>
				<button class="btn btn-primary btn-sm" type="submit">
					<i class="glyphicon glyphicon-plus"></i>&nbsp;#i18n{document.manage_documents.buttonCreate}
				</button>
			</form>
			</#if> </#if>
		</div>
		<div class="well well-sm">
			<#if document_types_filter_list?size &gt; 1 >
			<form class="form-inline col-xs-8 col-sm-8 col-md-8" method="post"
				name="FilterDocumentsForm"
				action="jsp/admin/plugins/document/ManageDocuments.jsp">
				<label>#i18n{document.manage_documents.labelType} :</label>
				<@comboWithParams name="document_type_code_filter"
				default_value="${default_document_type}"
				additionalParameters="class=\"\"" items=document_types_filter_list
				/> <label>#i18n{document.manage_documents.labelState} :</label>
				<@comboWithParams name="id_state_filter"
				default_value="${default_state}"
				additionalParameters="class=\"input-normal\""
				items=states_filter_list />
				<button class="btn btn-primary btn-xs" type="submit"
					title="#i18n{document.manage_documents.buttonFilter}">
					<i class="glyphicon glyphicon-filter"></i>
				</button>
			</form>
			</#if> <#if documents_list?size &gt; 0 >
			<form class="form-inline" method="post"
				action="jsp/admin/plugins/document/ManageDocuments.jsp">
				<label>#i18n{document.manage_documents.labelViewType}</label>
				<@comboWithParams name="view_type" default_value="${view_type}"
				additionalParameters="class=\"\"" items=view_types_list />
				<button class="btn btn-primary btn-xs" type="submit">
					<i class="glyphicon glyphicon-ok"></i>
				</button>
			</form>
			</#if>
		</div>
		<#if documents_list?size = 0 >
		<p class="alert alert-danger">#i18n{document.manage_documents.noDocument}</p>
		<#else> <#if view_type = "detail" >
		<form class="form-inline" id="documents_form" name="documents_form"
			method="post"
			action="jsp/admin/plugins/document/DoActionSelectionDocument.jsp">
			<table class="table table-striped table-condensed table-document">
				<tr>
					<th><input id="select_all" name="select_all" type="checkbox" /></th>
					<th class="col-xs-8 col-sm-8 col-md-8">#i18n{document.manage_documents.labelDocument}
						<span id="set_selection"> <select id="selection"
							name="selection" class="disabled" disabled="disabled">
								<option value="validate">#i18n{document.manage_document.validate}</option>
								<option value="submit">#i18n{document.manage_document.submit}</option>
								<option value="refuse">#i18n{document.manage_document.refuse}</option>
								<option value="remove">#i18n{document.manage_document.remove}</option>
								<option value="archive">#i18n{document.manage_document.archive}</option>
								<option value="unarchive">#i18n{document.manage_document.unarchive}</option>
						</select>
							<button class="btn btn-primary btn-xs disabled"
								disabled="disabled" type="submit"
								title="#i18n{document.manage_documents.applyToSelection}">
								<i class="glyphicon glyphicon-ok"></i>
							</button>
					</span>
					</th>
					<th>#i18n{document.manage_documents.labelPublishedStatus}<@sort
						jsp_url="jsp/admin/plugins/document/ManageDocuments.jsp"
						attribute="publishedStatus" /></th>
					<th>#i18n{document.manage_documents.labelActions}</th>
				</tr>
				<#list documents_list as document >
				<tr>
					<td><input id="document_selection" name="document_selection"
						type="checkbox" value="${document.id}" /></td>
					<td>
						<div class="row">
							<div class="col-xs-5 col-sm-5 col-md-5">
								<p>${document.id} - ${document.title}</p>
								<#if document.comment != "">
								<p class="alert alert-warning">
									<i class="glyphicon glyphicon-info-sign"></i>
									${document.comment}
								</p>
								</#if>
							</div>
							<div class="col-xs-4 col-sm-4 col-md-4"
								title="#i18n{document.manage_documents.labelState}">
								<#if document.stateId = 3> <span class="label label-success"><i
									class="glyphicon glyphicon-ok-sign"></i>&nbsp;&nbsp;${document.state}&nbsp;&nbsp;&nbsp;</span>
								<#else> <span class="label label-info"><i
									class="glyphicon glyphicon-remove-sign"></i>&nbsp;${document.state}
								</span> </#if>
							</div>
							<div class="col-xs-3 col-sm-3 col-md-3"
								title="#i18n{document.manage_documents.labelDateModification}">
								&nbsp;<i class="glyphicon glyphicon-calendar"></i>
								${document.dateModification}
							</div>
						</div>
					</td>
					<td><#if document.publishedStatus = 0> <span
						class="label label-success"><i
							class="glyphicon glyphicon-ok-sign"></i>
							#i18n{document.manage_documents.PublishedStatus}</span> <#else> <span
						class="label label-important"><i
							class="glyphicon glyphicon-remove-sign"></i>
							#i18n{document.manage_documents.UnPublishedStatus}</span> </#if>
					</td>
					<td><#list document.actions?reverse as action > <#if
						action.url?has_content> <a
						class="btn <@setBtnAction action_nb=action.idAction /> btn-xs"
						href="${action.url}id_document=${document.id}&id_action=${action.idAction}"
						title="${action.description}"> <i class="${action.iconUrl}"></i>
					</a> </#if> </#list>
					</td>
				</tr>
				</#list>
			</table>
		</form>
		</#if> </#if> <#if view_type = "thumbnail">
		<div class="col-xs-12 col-sm-12 col-md-12">
			<#list documents_list as document >
			<div class="col-xs-12 col-sm-6 col-md-4">
			<div class="thumbnail">
				<img src="${document.thumbnail}&nocache" class="thumbnail"
					alt="${document.title}"
					title="${document.title} - ${document.type}" />
				<div class="caption">
					<p>
						<span class="badge">${document.id}</span> <small><#if
							document.title?length &gt;
							18>${document.title?substring(0,18)}...<#else>${document.title}</#if></small>
					</p>
					<p>
						<#list document.actions?sort_by("idAction") as action > <#if
						action.url?has_content> <a
							class="btn btn-primary btn-xs <@setBtnAction action_nb=action.idAction />"
							href="${action.url}id_document=${document.id}&id_action=${action.idAction}"
							title="${action.description}"> <i class="${action.iconUrl}"></i>
						</a> </#if> </#list>
					</p>
				</div>
			</div>
			</div>
			</#list>
		</div>
		</#if>
		<@paginationAdmin paginator=paginator combo=1 />
		<#else> <#if child_spaces_list?size != 0 >
		<fieldset>
			<legend>#i18n{document.manage_documents.childSpacesList} :</legend>
			<ul class="unstyled">
				<#list child_spaces_list as child_space>
				<li>
					<h4>
						<a
							href="jsp/admin/plugins/document/ManageDocuments.jsp?id_space_filter=${child_space.id}">
							<img src="${child_space.iconUrl}"
							alt="${child_space.description}"
							title="${child_space.description}" />&nbsp;${child_space.name} <small>${child_space.description}</small>
						</a>
					</h4>
				</li> </#list>
			</ul>
		</fieldset>
		</#if> </#if>
	</div>
</div>

<script src="js/jquery/plugins/ui/jstree/jquery.jstree.js"></script>
<script src="js/jquery/plugins/ui/jstree/jquery.cookie.js"></script>
<script type="text/javascript">
	jQuery(function($) {
		// Set space_id
		var spaceid = $
		{
			space.id
		}
		;
		// Get space_id from url parameter
		var loc = location.search;
		if (spaceid != loc) {
			if (loc.indexOf("id_space_filter") > 0) {
				// Set space_id from url parameter if exists
				spaceid = loc.slice(loc.lastIndexOf("=") + 1);
			}
		}

		// Set the cookie of jstree
		$.cookie("jstree_select", "#node-" + spaceid);
		$("#tree").jstree({
			"ui" : {
				"select_limit" : 1,
			},
			"themes" : {
				"theme" : "apple",
				"icons" : false
			},
			"cookies" : {
				"save_opened" : true,
			},
			"core" : {
				"initially_open" : [ "node-${space.id}" ]
			},
			"plugins" : [ "themes", "html_data", "cookies", "ui" ]
		});
	});

	$("#select_all").click(function() {
		$("input[type='checkbox']").attr('checked', this.checked);
	});

	$("input[type='checkbox']").click(function() {
		if ($("input[type='checkbox']:checked").length > 0) {
			$("#set_selection").children().removeAttr("disabled");
		} else {
			$("#set_selection").children().attr("disabled", "disabled");
		}
	});

	$("#FullTextSearchDocument p.help-block").text(
			"#i18n{document.manage_document.labelAllTextSearch}");
	$("#FullTextSearchDocument")
			.submit(
					function() {
						if ($
								.isNumeric($(
										"#FullTextSearchDocument input#query")
										.val())) {
							$("#FullTextSearchDocument input#id_document").val(
									$("#FullTextSearchDocument input#query")
											.val());
							$(this)
									.attr("action",
											"jsp/admin/plugins/document/DoSearchDocumentById.jsp");
						}
					});
	$("#SearchDocumentById").hide();
</script>

<div id="modalPortletPublishing" class="modal hide fade" tabindex="-1"
	role="dialog">
	<div class="modal-header">
		<button type="button" class="close" data-dismiss="modal">x</button>
		<h3>Titre</h3>
	</div>
	<div class="modal-body">
		<iframe id="portletPublishingFrame" src="#" frameborder="0"
			height="600" width="800"></iframe>
	</div>
	<div class="modal-footer">
		<button class="btn" data-dismiss="modal" aria-hidden="true">Fermer</button>
	</div>
</div>
<script type="text/javascript">
	$(function() {
		$(".btn-dialog").click(function() {
			var urlIframe = $(this).attr("href");
			$("#portletPublishingFrame").attr("src", $(this).attr("href"));
			$("#modalPortletPublishing").modal({
				title : 'eeee',
				backdrop : 'static'
			});
			return false;
		});
	});
</script>
